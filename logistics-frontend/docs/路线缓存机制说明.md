# 路线缓存机制说明

## 功能介绍

为了优化高德地图路径规划API的调用次数，减少API请求频率，提升用户体验，系统实现了路线缓存机制。当用户请求相同起点、终点和途经点的路线时，系统会优先从本地缓存中获取结果，而不是重新调用高德API。

## 主要特性

1. **智能缓存**：路线规划结果会按照起点、终点、途经点和路线策略的组合进行缓存
2. **数据压缩**：使用LZ-String对缓存数据进行压缩，大幅减少存储空间占用
3. **自动过期**：缓存数据有24小时的默认过期时间，过期后自动清理
4. **缓存管理**：内置缓存大小控制和自动清理机制，防止占用过多存储空间
5. **用户界面**：提供缓存统计和手动清理功能，方便用户了解和管理缓存

## 技术实现

### 缓存键设计

缓存键由以下部分组成：
```
起点经度,起点纬度|终点经度,终点纬度|途经点1经度,途经点1纬度|...|路线策略
```

这种设计确保了相同路线组合能够被准确识别和缓存。

### 存储方式

- 使用浏览器的`localStorage`进行持久化存储
- 通过LZ-String库对JSON数据进行压缩，节省存储空间
- 缓存结构设计包含了时间戳和大小信息，便于管理

### 缓存管理

- 最大缓存大小限制为10MB
- 当空间不足时，按照最近最少使用原则清理旧数据
- 可根据项目需求调整`CACHE_EXPIRY`和`MAX_CACHE_SIZE`参数

## 使用方法

### 基本使用

无需特殊操作，系统会自动缓存和使用缓存的路线数据。

### 清除缓存

在地图控制面板上提供了两个按钮：
- **缓存统计**：查看当前缓存状态和详细信息
- **清除缓存**：手动清除所有缓存数据

也可以通过代码调用清除：
```javascript
import { clearRouteCache } from '@/utils/mapUtils';

// 清除所有缓存
clearRouteCache(true);

// 只清除过期缓存
const stats = clearRouteCache(false);
console.log(`当前缓存条目: ${stats.cacheEntries}, 大小: ${stats.cacheSize}`);
```

## 代码位置

- 核心实现：`src/utils/mapUtils.ts`
- 用户界面：`src/pages/PathPlanning/components/RouteMap.jsx`

## 优化建议

1. 在多条件查询频繁的场景中，路线缓存可以显著减少API调用次数
2. 对于长距离、多途经点的复杂路线，缓存带来的性能提升更为明显
3. 如需在后端实现类似缓存，可考虑使用Redis等缓存服务

## 注意事项

1. 缓存会随浏览器清除本地存储而丢失
2. 如高德地图路线规划逻辑有重大更新，建议手动清除缓存
3. 如发现路线显示异常，可尝试清除缓存解决 